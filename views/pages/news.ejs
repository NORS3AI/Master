<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>News - RS News</title>
  <link rel="stylesheet" href="/css/style.css">
</head>
<body <% if (isAuthenticated) { %>data-user-id="<%= userId %>"<% } %>>
  <%-include('../components/navbar') %>

  <div class="container">
    <div class="page-header">
      <h1>Latest News</h1>
      <p>Stay informed about developments in mail and parcel services</p>
    </div>

    <div class="news-section">
      <div class="news-list" id="newsList">
        <!-- Articles will be loaded here by JavaScript -->
      </div>
    </div>
  </div>

  <%-include('../components/footer') %>

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="/js/main.js"></script>
  <script src="/js/modal.js"></script>
  <script>
    // Load and display articles
    async function loadAndDisplayArticles() {
      try {
        const response = await fetch('/api/articles');
        if (!response.ok) throw new Error('Failed to load articles');
        const articles = await response.json();

        const newsList = document.getElementById('newsList');
        newsList.innerHTML = '';

        if (articles.length === 0) {
          newsList.innerHTML = '<p style="text-align: center; padding: 2rem;">No articles found.</p>';
          return;
        }

        articles.forEach(article => {
          const date = new Date(article.date).toLocaleDateString('en-US', {
            month: 'short',
            day: 'numeric',
            year: 'numeric'
          });

          const articleHTML = `
            <article class="news-item" onclick="openArticleModal('${article._id}')" style="cursor: pointer;">
              <h3>${article.title}</h3>
              <p class="date">${date}</p>
              <div style="display: flex; gap: 1rem; margin-bottom: 1rem; font-size: 0.85rem;">
                <span class="modal-meta-badge" style="margin: 0;">${article.category}</span>
                <span>${article.readTime} min read</span>
              </div>
              <p>${article.description}</p>
              <a class="read-more" onclick="event.stopPropagation();">Read More</a>
            </article>
          `;
          newsList.insertAdjacentHTML('beforeend', articleHTML);
        });
      } catch (error) {
        console.error('Error loading articles:', error);
        document.getElementById('newsList').innerHTML = '<p style="text-align: center; color: red;">Failed to load articles.</p>';
      }
    }

    // Load articles when page is ready
    document.addEventListener('DOMContentLoaded', () => {
      loadAndDisplayArticles();
    });
  </script>
</body>
</html>
