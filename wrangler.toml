name = "rsnews"
main = "src/workers/index.js"
compatibility_date = "2024-01-01"
account_id = "8c338f96fc4756f94cea4c367a604b34"

# Routes and deployment settings
routes = [
  { pattern = "rsnewsroom.nors3ai.com", zone_name = "nors3ai.com" }
]

# Build configuration
build = {
  command = "npm run build",
  cwd = "."
}

# Environment variables
[env.production]
name = "rsnews-production"
routes = [
  { pattern = "rsnewsroom.nors3ai.com", zone_name = "nors3ai.com" }
]
vars = {
  ENVIRONMENT = "production",
  MONGODB_URI = "mongodb+srv://${MONGODB_USER}:${MONGODB_PASSWORD}@cluster.mongodb.net/rsnews"
}

[env.staging]
name = "rsnews-staging"
routes = [
  { pattern = "staging-rsnewsroom.nors3ai.com", zone_name = "nors3ai.com" }
]
vars = {
  ENVIRONMENT = "staging",
  MONGODB_URI = "mongodb+srv://${MONGODB_USER}:${MONGODB_PASSWORD}@cluster.mongodb.net/rsnews-staging"
}

[env.development]
name = "rsnews-dev"
vars = {
  ENVIRONMENT = "development",
  MONGODB_URI = "mongodb://localhost:27017/rsnews"
}

# D1 Database binding
[[d1_databases]]
binding = "DB"
database_name = "rsnews-db1"
database_id = "rsnews-db1"

# Analytics Engine binding
[[analytics_engine_datasets]]
binding = "ANALYTICS"

# Environment-specific D1 databases
[env.production.d1_databases]
[env.production.d1_databases.DB]
database_name = "rsnews-db1-production"
database_id = "rsnews-db1-prod"

[env.staging.d1_databases]
[env.staging.d1_databases.DB]
database_name = "rsnews-db1-staging"
database_id = "rsnews-db1-staging"

# Environment-specific Analytics
[env.production.analytics_engine_datasets]
[env.production.analytics_engine_datasets.ANALYTICS]
binding = "ANALYTICS"

[env.staging.analytics_engine_datasets]
[env.staging.analytics_engine_datasets.ANALYTICS]
binding = "ANALYTICS_STAGING"

[env.development.analytics_engine_datasets]
[env.development.analytics_engine_datasets.ANALYTICS]
binding = "ANALYTICS_DEV"

# Triggers for scheduled jobs
[triggers]
crons = [
  "0 0 * * *"  # Daily job at midnight UTC
]

# Observability settings
[observability]
enabled = true
